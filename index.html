<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Semantic GAN</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    
    <header class="header">
      <h1>Semantic GAN</h1>
      
      <div class="intro">
        An automated pipeline for generating RDF triples from the 
        <a href="https://dblp.org/xml/" target="_blank" style="color: var(--accent); text-decoration: none; border-bottom: 1px dotted;">DBLP Computer Science dataset</a> 
        using a 
        <a href="https://fr.wikipedia.org/wiki/R%C3%A9seaux_antagonistes_g%C3%A9n%C3%A9ratifs_de_Wasserstein" target="_blank" style="color: var(--accent); text-decoration: none; border-bottom: 1px dotted;">Wasserstein GAN</a>.
      </div>
      
      <div class="last-updated" id="lastUpdated">Loading system status...</div>
    </header>

    <main id="main">
      
      <div class="section">
        <h2>Performance</h2>
        <p class="note-description">
          Metrics calculated from the latest generated synthetic dataset.
        </p>
        
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-val" id="noveltyScore">--%</div>
            <div class="metric-label">Novelty Score</div>
            <div class="metric-sub">Previously unseen RDF statements</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-val" id="uniqueScore">--%</div>
            <div class="metric-label">Diversity Score</div>
            <div class="metric-sub">Distinct generated relations</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-val" id="totalGen">--</div>
            <div class="metric-label">Generated RDF Candidates</div>
            <div class="metric-sub">Produced in the latest run</div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Generated RDF Hypotheses</h2>
        <p class="note-description">
          The following connections were generated by the Generative Adversarial Network. 
          <span class="novel-tag">NOVEL</span> indicates a connection not present in the original training data.
        </p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th style="width: 25%">Relation</th>
                <th style="width: 50%">Generated Entity</th>
                <th style="width: 15%">Confidence</th>
                <th style="width: 10%">Type</th>
              </tr>
            </thead>
            <tbody id="hypothesesTable">
              <tr>
                <td colspan="4" style="text-align:center; padding: 20px;">
                  Loading model outputs...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="section">
        <h2>Training Dynamics</h2>
        <p class="note-description">
          Convergence stability of the Wasserstein GAN over fifty training epochs.
        </p>
        <div class="chart-container">
          <img
            src="src/loss_curve.png"
            alt="Training loss curve"
            onerror="this.style.display='none'; this.parentElement.innerHTML='<p style=&quot;color:#999&quot;>Chart pending next training run.</p>'"
          >
        </div>
      </div>

    </main>

    <script>
      async function loadDashboard() {
        try {
          const response = await fetch('src/dashboard_data.json', { cache: "no-store" });
          if (!response.ok) throw new Error("Dashboard data not found");
          
          const data = await response.json();

          document.getElementById('lastUpdated').innerText =
            "System Status: ONLINE | Last Run: " + data.last_updated;

          document.getElementById('noveltyScore').innerText =
            data.stats.novelty + "%";
          document.getElementById('uniqueScore').innerText =
            data.stats.uniqueness + "%";
          document.getElementById('totalGen').innerText =
            data.stats.total_generated;

          const tbody = document.getElementById('hypothesesTable');
          tbody.innerHTML = '';

          if (data.hypotheses.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="4" style="text-align:center">No generated relations available.</td></tr>';
            return;
          }

          data.hypotheses.forEach(h => {
            const tr = document.createElement('tr');

            const badge = h.novel
              ? '<span class="novel-tag">NOVEL</span>'
              : '<span style="color: #999; font-size: 0.8em; font-weight: 500;">EXISTING</span>';

            tr.innerHTML = `
              <td style="color: var(--text-primary); font-weight: 600;">
                ${h.relation}
              </td>
              <td style="white-space: normal;">
                ${h.entity}
              </td>
              <td style="font-family: monospace;">
                ${h.score}
              </td>
              <td>
                ${badge}
              </td>
            `;
            tbody.appendChild(tr);
          });

        } catch (err) {
          console.error(err);
          document.getElementById('lastUpdated').innerText =
            "System Status: OFFLINE (Data missing)";
          document.getElementById('hypothesesTable').innerHTML =
            '<tr><td colspan="4" style="color: red; text-align: center;">Error loading dashboard data. Ensure update_dashboard.py has run.</td></tr>';
        }
      }

      document.addEventListener("DOMContentLoaded", loadDashboard);
    </script>
  </body>
</html>